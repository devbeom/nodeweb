var DATABASE = 'test';
var TABLE = 'Member';
var Client = require('mysql').Client;
var client = new Client();


client.user = 'root';
client.password = '1234';
client.useDatabase('test');

var mysqlUtil = module.exports = {
		insertUser: function(user, res) {
			client.query(
				'insert into ' + TABLE + ' SET name=?, email=?'
				, [user.name, user.email]
				, function(err) {
						client.query(
							'select * from ' + TABLE + ' where name = ?'
							, [user.name]
							, function(err, results) {
								if(err) {
									throw err;
								}
								res.render('join-result', {
										username: results[0].name
										, useremail: results[0].email
										, title: 'Result'
										, joinSuccess: true
								});
						 	}
						);
					}
			);
		}, 
		
		hasNameAndEmail: function(user, res) {
			client.query(
				'select * from ' + TABLE + ' where name=? or email=?'
				, [user.name, user.email]
				, function(err, results) {
					if(err)
						throw err;
					if(results.length > 0) {
						res.render('join-fail', {
							title: "join-fail"
						});
					} else {
						mysqlUtil.insertUser(user,res);
					}
				}
			);
		},
		
		SelectList: function(user, callback) {
			client.query(
				'select * from Member'
				,callback
			);
		}
};

